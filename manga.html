<!DOCTYPE html>
<html>
<head>
  <title>udspj</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
    html,body 
    {
      overflow:hidden; margin:0px; width:100%; height:100%;
    }
    .danmu
    {
        color: white;
        text-shadow:
        -1px -1px 0 #000,
        1px -1px 0 #000,
        -1px 1px 0 #000,
        1px 1px 0 #000; 
        font-size: 150%;
        position:absolute;
        white-space:nowrap;
    }
    #imgdiv 
    {
      margin-left: auto; margin-right: auto;text-align : center; 
      width:100%; height:100%;
      overflow-y:scroll; overflow-x:auto;
    }
    #mangaimg
    {
      max-width:600px; min-width:100px; 
      margin-left: auto; margin-right: auto;text-align : center;
    }
    #dammaku
    {
      right:0; top:0; width:100%; position:fixed; padding:10px;
    }
    #imageselector
    {
      bottom: 0; width:100%; height:150px; position:fixed; background-color: #000; opacity:0.7; padding:10px;
    }
    #disqus_thread
    {
      position: relative; display:block; margin: 0px 50px 0px 50px; 
    }

    #buttonscontainer { height: 100%; width: calc(100% - 20px); position: relative; -moz-user-select: none; -webkit-user-select: none; }
    #imgbtn { bottom: 0; position:fixed; }
    </style>
</head>
<body>
  <div id="danmaku" width="100%" height="300px"></div>
  <div id="imageselector">
    <div id="buttonscontainer"></div>
  </div>
  <img id="imgbtn" src="manga/listctrlbtn.png" width="200px" height="300px" />
  <div id="imgdiv">
      <h1 id="title">评论弹幕加载中...</h1>
      <img id="mangaimg" src="791.jpg" align="center"/>
      <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
      </div>
  </div>
    
</body>

<script language='javascript' src="manga/manga_src.js"></script>
<script>


var imgarray = MangaList;//["http://ww4.sinaimg.cn/large/48a8af64gw1f58uj5rmq0j20go2patgu.jpg","802.jpg","803.jpg","804.jpg","805.jpg","806.jpg","807.jpg","808.jpg","809.jpg","73.jpg","791.jpg","801.jpg","802.jpg","803.jpg","804.jpg","805.jpg","806.jpg","807.jpg","808.jpg","809.jpg"]
var x,y,m;
function _id(id) {return document.getElementById(id);}
window.onload=function(e){
  _id("imgbtn").ondragstart=function(){return false};
_id('buttonscontainer').onselectstart=function(){return false};
_id('buttonscontainer').onmousedown=function(e){
e=e||window.event;
e.which=e.which||e.button;
e.pageX=e.pageX||e.x;
// e.pageY=e.pageY||e.y;
if(e.which == 1) {
m = true;
x = e.pageX - parseInt(this.offsetLeft);
// y = e.pageY - parseInt(this.offsetTop);
}
}
_id('buttonscontainer').style.left = "200px";
document.onmousemove = function(e){
e=e||window.event;
e.which=e.which||e.button;
e.pageX=e.pageX||e.x;
// e.pageY=e.pageY||e.y;
if(m) {
_id('buttonscontainer').style.left=e.pageX-x+'px';
// _id('id').style.top=e.pageY-y+'px';
if (parseInt(_id('buttonscontainer').style.left) > parseInt(200))
{
  _id('buttonscontainer').style.left = "200px";
}
if (parseInt(_id('buttonscontainer').style.left) < parseInt(document.body.clientWidth - imgarray.length * 150 - 10))
{
  _id('buttonscontainer').style.left = String(document.body.clientWidth - imgarray.length * 150 - 10)+"px";
}
}
}
document.onmouseup = function(){ m = false; }
}

_id('buttonscontainer').style.width = String(imgarray.length * 150)+"px";
for (var i = 0; i < imgarray.length; i ++)
{
          var para = document.createElement("div");
          // para.style.left = String(i * 100)+"px";
          para.style.top = "0px";
          para.style.width = "130px";
          para.style.height = "130px";
          para.style.background = "#ffffff";
          para.style.float = "left";
          para.style.margin = "10px";
          para.id = imgarray[i]["url"];
          para.innerHTML = imgarray[i]["title"];
          para.align = "center";
          para.onclick = function() {
            var imgcon = document.getElementById("mangaimg");
            imgcon.src = this.id;
          };

          var paraimg = document.createElement("img");
          paraimg.src = "manga/defaultimg.jpg";
          paraimg.ondragstart = function() {
            return false;
          };
          para.appendChild(paraimg);

          var div = document.getElementById("buttonscontainer");
          div.appendChild(para);
}
var isopenlist = true;
imgbtn.onclick = function() {
  var btncontainer = document.getElementById("buttonscontainer");
  btncontainer.hidden = isopenlist;
  var btnbk = document.getElementById("imageselector");
  if ( isopenlist ) {
    btnbk.style.width = "200px";
  } else {
    btnbk.style.width = "100%";
  }
  isopenlist = !isopenlist;
};

            var imgcon = document.getElementById("mangaimg");
            imgcon.onload = function() {
            }







var responseRes;
var danmuarray = new Array();

var vx = -5;
var danmucount;
var maxscreencount = 5;
var screendanmu = new Array();
var danmuindex = 0

function showDanmus()
{
    danmucount = danmuarray.length;
    createDanmus();
    runDanmus();
}

function createDanmus()
{
    if(screendanmu.length < maxscreencount && danmuindex < danmucount)
    {
          var para = document.createElement("p");
          var danmutext = document.createTextNode(danmuarray[danmuindex]);
          para.setAttribute("class","danmu");
          para.style.left = String(document.body.clientWidth)+"px";
          para.style.top = String(Math.ceil(Math.random()*100))+"px";
          para.appendChild(danmutext);
          var div = document.getElementById("danmaku");
          div.appendChild(para);
          screendanmu[screendanmu.length] = para;
          danmuindex ++;
    }

    setTimeout(createDanmus,5000)
}

function runDanmus()
{
  if(screendanmu.length > 0)
  {
      for (var i = 0; i < screendanmu.length; i++) 
    {
      screendanmu[i].style.left = String(parseInt(screendanmu[i].style.left)+vx)+"px"
    }

    // 此处把屏幕外弹幕remove
    if (parseInt(screendanmu[0].style.left) < -parseInt(screendanmu[0].offsetWidth)) 
    {
      screendanmu[0].remove();
      screendanmu.splice(0, 1);
    }
  }

    setTimeout(runDanmus,50)
}
//https://disqus.com/api/docs/posts/list/
        var urlreq = new XMLHttpRequest()
          urlreq.open('GET','https://disqus.com/api/3.0/posts/list.json?api_key=fDv3hhNLuouP8ZPpiptoPE1OPU0pq9qtohiIx2GDbSLVWaNkOB6V3X1RnZMsuINF&forum=udspj&limit=100')
          var self = this
          urlreq.onload = function(){
            responseRes = JSON.parse(urlreq.responseText).response;
            for(j = 0;j <responseRes.length; j++)
            {
                danmuarray[j] = responseRes[j].raw_message;
            }
            showDanmus();
            var title = document.getElementById("title");
            title.innerHTML = "";
          }
          urlreq.send()
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    
    var disqus_config = function () {
        this.page.url = "http://udspj.github.io";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "http://udspj.github.io"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//udspj.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
  
</script>
</html>
